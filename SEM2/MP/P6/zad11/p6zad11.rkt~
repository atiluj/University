#lang racket
(struct const (val)    #:transparent)
(struct binop (op l r) #:transparent)

(define (delete-nth list n) ;;funkcja usuwajÄ…cy i-ty element w liscie
    (if (= n 0)
        (cdr list)
        (cons (car list) (delete-nth (cdr list) (- n 1)))))
  
(define (converse-rpn w iter) ;;wywolanie od iter=0
    (if (and (< iter (length w)) (member (list-ref w iter) '(+ - * /)))
        (if (< iter 2)
            (error "niepoprawne wyrazenie w RPN")
            (let* ([l (list-ref w (- iter 2))]
                   [r (list-ref w (- iter 1))]
                   [w-update (list-set w (- iter 2) (binop (list-ref w iter) l r))])
                (converse-rpn (delete-nth (delete-nth w-update (- iter 1)) (- iter 1)) (- iter 1))))
        (if (= iter (length w))
            w
            (converse-rpn w (+ iter 1)))))